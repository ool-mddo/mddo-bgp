system {
    host-name edge-tk03;
    root-authentication {
        encrypted-password "$6$vOte4zs5$j1X3fElYvJSt8VPNXx2KzRNrZIkp9CeRX83/W4wQo5K4Tl/MHZeMcvbymEzm9/2ya3S4hU993YDSLY26ROGnW/"; ## SECRET-DATA
    }
    login {
        user vrnetlab {
            uid 2000;
            class super-user;
            authentication {
                encrypted-password "$6$CDmzGe/d$g43HmhI3FA.21JCYppnTg1h4q/JO4DOHSICLhhavqBem5zUTgKEcg5m9tBG1Ik6qmfb7L3v.wgj4/DkfgZejO0"; ## SECRET-DATA
            }
        }
    }
    services {
        ssh;
        netconf {
            ssh;
        }
    }
}
interfaces {
    /*GigabitEthernet0/0/0/0*/
    eth1 {
        description "to_Seg-192.168.1.0-24_Ethernet5"
        unit 0 {
            family inet {
                address 192.168.1.5/24;
            }
        }
    }
    /*Loopback0*/
    lo {
        unit 0 {
            family inet {
                address 192.168.255.7/32;
            }
        }
    }
    /*GigabitEthernet0/0/0/1*/
    eth2 {
        description "to_Seg-192.168.0.16-30_Ethernet1"
        unit 0 {
            family inet {
                address 192.168.0.17/30;
            }
        }
    }
    /*GigabitEthernet0/0/0/2*/
    eth3 {
        description "to_Seg-172.16.1.16-30_Ethernet1"
        unit 0 {
            family inet {
                address 172.16.1.18/30;
            }
        }
    }
}
routing-options {
    rib inet.0 {
        static {
            route 172.31.255.1/32 {
                discard;
                preference 1;
                metric 0;
            }
        }
    }
    autonomous-system 65500;
    confederation 65518 members [ 65500 ];
}

policy-options {
    prefix-list as65550-advd {
        10.100.0.0/16;
    }
    prefix-list default-ipv4 {
        0.0.0.0/0;
    }
    prefix-list longer24-ipv4 {
        0.0.0.0/0;
    }
    as-path-group any {
        as-path any ".*";
    }
    as-path-group as65550-origin {
        as-path as65550-origin "^(65550 )+$";
    }
    as-path-group aspath-longer200 {
        as-path aspath-longer200 ".{200,}";
    }
    community any members *:*;
    community poi members 65518:20;
    community peer members 65518:2;
    community aggregate members 65518:1;
    community as65518-any members 65518:.*;
    policy-statement POI-East_in {
        term POI-East_in-10 {
            from {
            }
            then {
                metric 100;
                local-preference 300;
                community delete any;
                community set poi;
                accept;
            }
        }
    }
    policy-statement if-condition-reject-in-ipv4-10 {
        term 10 {
            from {
                route-filter 0.0.0.0/0 prefix-length-range /25-/32;
            }
            then {
                accept;
            }
        }
        then {
            reject;
        }
    }
    policy-statement not-if-condition-reject-in-ipv4-10 {
        term 10 {
            from {
                policy if-condition-reject-in-ipv4-10;
            }
            then {
                reject;
            }
        }
        then {
            accept;
        }
    }
    policy-statement if-condition-reject-in-ipv4-20 {
        term 10 {
            from {
                route-filter 0.0.0.0/0 exact;
            }
            then {
                accept;
            }
        }
        then {
            reject;
        }
    }
    policy-statement not-if-condition-reject-in-ipv4-20 {
        term 10 {
            from {
                policy if-condition-reject-in-ipv4-20;
            }
            then {
                reject;
            }
        }
        then {
            accept;
        }
    }
    policy-statement if-condition-reject-in-ipv4-30 {
        term 10 {
            from {
                as-path-group aspath-longer200;
            }
            then {
                accept;
            }
        }
        then {
            reject;
        }
    }
    policy-statement not-if-condition-reject-in-ipv4-30 {
        term 10 {
            from {
                policy if-condition-reject-in-ipv4-30;
            }
            then {
                reject;
            }
        }
        then {
            accept;
        }
    }
    policy-statement reject-in-ipv4 {
        term reject-in-ipv4-10 {
            from {
                policy if-condition-reject-in-ipv4-10;
            }
            then {
                reject;
            }
        }
        term reject-in-ipv4-20 {
            from {
                policy if-condition-reject-in-ipv4-20;
            }
            then {
                reject;
            }
        }
        term reject-in-ipv4-30 {
            from {
                policy if-condition-reject-in-ipv4-30;
            }
            then {
                reject;
            }
        }
        term reject-in-ipv4-40 {
            from {
            }
            then {
                next term;
            }
        }
    }
    policy-statement if-condition-reject-out-ipv4-10 {
        term 10 {
            from {
                route-filter 0.0.0.0/0 prefix-length-range /25-/32;
            }
            then {
                accept;
            }
        }
        then {
            reject;
        }
    }
    policy-statement not-if-condition-reject-out-ipv4-10 {
        term 10 {
            from {
                policy if-condition-reject-out-ipv4-10;
            }
            then {
                reject;
            }
        }
        then {
            accept;
        }
    }
    policy-statement if-condition-reject-out-ipv4-20 {
        term 10 {
            from {
                route-filter 0.0.0.0/0 exact;
            }
            then {
                accept;
            }
        }
        then {
            reject;
        }
    }
    policy-statement not-if-condition-reject-out-ipv4-20 {
        term 10 {
            from {
                policy if-condition-reject-out-ipv4-20;
            }
            then {
                reject;
            }
        }
        then {
            accept;
        }
    }
    policy-statement reject-out-ipv4 {
        term reject-out-ipv4-10 {
            from {
                policy if-condition-reject-out-ipv4-10;
            }
            then {
                reject;
            }
        }
        term reject-out-ipv4-20 {
            from {
                policy if-condition-reject-out-ipv4-20;
            }
            then {
                reject;
            }
        }
        term reject-out-ipv4-30 {
            from {
            }
            then {
                next term;
            }
        }
    }
    policy-statement if-condition-as65550-peer-in1-tyo-ipv4-20 {
        term 10 {
            from {
                as-path-group as65550-origin;
            }
            then {
                accept;
            }
        }
        then {
            reject;
        }
    }
    policy-statement not-if-condition-as65550-peer-in1-tyo-ipv4-20 {
        term 10 {
            from {
                policy if-condition-as65550-peer-in1-tyo-ipv4-20;
            }
            then {
                reject;
            }
        }
        then {
            accept;
        }
    }
    policy-statement if-condition-as65550-peer-in1-tyo-ipv4-30 {
        term 10 {
            from {
                as-path-group any;
            }
            then {
                accept;
            }
        }
        then {
            reject;
        }
    }
    policy-statement not-if-condition-as65550-peer-in1-tyo-ipv4-30 {
        term 10 {
            from {
                policy if-condition-as65550-peer-in1-tyo-ipv4-30;
            }
            then {
                reject;
            }
        }
        then {
            accept;
        }
    }
    policy-statement as65550-peer-in1-tyo-ipv4 {
        term as65550-peer-in1-tyo-ipv4-10 {
            from {
            }
            then {
            }
        }
        term as65550-peer-in1-tyo-ipv4-20 {
            from {
                policy if-condition-as65550-peer-in1-tyo-ipv4-20;
            }
            then {
                local-preference 300;
                metric 100;
                community set peer;
                accept;
            }
        }
        term as65550-peer-in1-tyo-ipv4-30 {
            from {
                policy if-condition-as65550-peer-in1-tyo-ipv4-30;
            }
            then {
                local-preference 210;
                metric 100;
                community set peer;
                accept;
            }
        }
        term as65550-peer-in1-tyo-ipv4-40 {
            from {
            }
            then {
                reject;
            }
        }
    }
    policy-statement if-condition-as65550-peer-out1-tyo-ipv4-20 {
        term 10 {
            from {
                community [  aggregate ];
            }
            then {
                accept;
            }
        }
        then {
            reject;
        }
    }
    policy-statement not-if-condition-as65550-peer-out1-tyo-ipv4-20 {
        term 10 {
            from {
                policy if-condition-as65550-peer-out1-tyo-ipv4-20;
            }
            then {
                reject;
            }
        }
        then {
            accept;
        }
    }
    policy-statement as65550-peer-out1-tyo-ipv4 {
        term as65550-peer-out1-tyo-ipv4-10 {
            from {
            }
            then {
            }
        }
        term as65550-peer-out1-tyo-ipv4-20 {
            from {
                policy if-condition-as65550-peer-out1-tyo-ipv4-20;
            }
            then {
                metric 100;
                community delete any;
                accept;
            }
        }
        term as65550-peer-out1-tyo-ipv4-30 {
            from {
            }
            then {
                reject;
            }
        }
    }
    policy-statement if-condition-as65550-peer-out2-tyo-ipv4-20 {
        term 10 {
            from {
                community [  aggregate ];
                route-filter 10.100.0.0/16 exact;
            }
            then {
                accept;
            }
        }
        then {
            reject;
        }
    }
    policy-statement not-if-condition-as65550-peer-out2-tyo-ipv4-20 {
        term 10 {
            from {
                policy if-condition-as65550-peer-out2-tyo-ipv4-20;
            }
            then {
                reject;
            }
        }
        then {
            accept;
        }
    }
    policy-statement as65550-peer-out2-tyo-ipv4 {
        term _generated_next-hop-self {
            from {
            }
            then {
                next-hop self;
            }
        }
        term as65550-peer-out2-tyo-ipv4-10 {
            from {
            }
            then {
            }
        }
        term as65550-peer-out2-tyo-ipv4-20 {
            from {
                policy if-condition-as65550-peer-out2-tyo-ipv4-20;
            }
            then {
                metric 100;
                community delete any;
                accept;
            }
        }
        term as65550-peer-out2-tyo-ipv4-30 {
            from {
            }
            then {
                reject;
            }
        }
    }
    policy-statement ibgp-export {
        term _generated_next-hop-self {
            from {
                protocol bgp;
            }
            then {
                local-preference 100;
                next-hop self;
            }
        }
    }
}
protocols {
    bgp {
        family inet {
            unicast;
        }
        group 172.16.1.17 {
            family inet {
                unicast;
            }
            peer-as 65550;
            local-as 65500;
            type external;
            hold-time 90;
            neighbor 172.16.1.17 {
                local-address 172.16.1.18;
                import as65550-peer-in1-tyo-ipv4;
                export as65550-peer-out2-tyo-ipv4;
            }
        }
        group 192.168.255.2 {
            family inet {
                unicast;
            }
            peer-as 65500;
            local-as 65500;
            type internal;
            hold-time 90;
            neighbor 192.168.255.2 {
                local-address 192.168.255.7;
                export ibgp-export;
            }
        }
        group 192.168.255.1 {
            family inet {
                unicast;
            }
            peer-as 65500;
            local-as 65500;
            type internal;
            hold-time 90;
            neighbor 192.168.255.1 {
                local-address 192.168.255.7;
                export ibgp-export;
            }
        }
        group 192.168.0.18 {
            family inet {
                unicast;
            }
            peer-as 65520;
            local-as 65500;
            type external;
            hold-time 90;
            neighbor 192.168.0.18 {
                local-address 192.168.0.17;
                import POI-East_in;
            }
        }
    }
}
protocols {
    ospf {
        area 0.0.0.10 {
            interface eth1 {
                metric 10;
                priority 10;
                hello-interval 10;
                dead-interval 40;
            }
            interface lo.0 {
                metric 1;
                priority 10;
                hello-interval 10;
                dead-interval 40;
            }
        }
    }
}